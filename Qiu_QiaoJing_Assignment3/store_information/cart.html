
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <script src="./functions.js"></script>
    <script>
        let params = (new URL(document.location)).searchParams;
        shopping_cart = {};
        loadJSON('get_cart', function (response) {
            // Parsing JSON string into object
            shopping_cart = JSON.parse(response);
            for (product_key in shopping_cart) {
                total += shopping_cart[product_key].reduce((a, b) => a + b);
            }
        });
        var products_data;
        loadJSON('get_products_data', function (response) {
            // Parsing JSON string into object
            products_data = JSON.parse(response);
        });
        products=products_data;
    </script>
</head>
<body>
    
    <!--Create a Top Navigation Bar-->
    <!--Reference: https://www.w3schools.com/howto/howto_js_topnav.asp-->
    <div class="topnavbar">
        <a class="homepage" href="index.html">Home</a>
        <script>
            // to change navigation bar presentation based on client's login status
            if (typeof document.cookie != 'undefined' && document.cookie != ""){ 
            // cookie exists and is not detelted
               document.write(`
                <a class="userlogin" onclick="cookieExpire ()" href="login_page.html">Log Out</a>
            `)} else if (document.cookie == "" || typeof document.cookie == 'undefined') {
            // cookie is deleted or undefined, client is logout
                document.write(`
                <a class="userlogin" href="login_page.html">Login My Account</a>
            `)};
        </script>
        <a class="userregistration" href="registration_page.html">Create An Account</a>
        <a class="display1" href="display_tax.html">Tax Service</a>
        <a class="display2" href="display_cpa.html">Prepare CPA Exam</a>
        <a class="display3" href="display_tutorial.html">Tutorial Session</a>
        <a class="display4" href="display_consultant.html">Consultant</a>
        <a class="cart">Shopping Cart</a>
    </div>

    <h1>Your Shopping Cart:</h1>
    <br>
    <script>
    let firstpart = document.cookie.split('=')
    let uname = firstpart[firstpart.length - 1];
        if (typeof document.cookie != 'undefined' && document.cookie != ""){ 
            document.write(`
            <h2>Hey ${uname}, this is everything in you shopping cart!</h2>
            <p>Back: Go back to the display page for more products' information</p>
            <p>Check Out: To place your order</p>
            `)} else if (document.cookie == "" || typeof document.cookie == 'undefined') {
                document.write(`
            <h2>Welcome, this is everything in you shopping cart!</h2>
            <p>Back: Go back to the display page for more products' information</p>
            <p>Check Out: To place your order</p>
            <p>Please log in you account before checking out</p>
            `)
            }
    </script>

<table border="5">
    <tbody>
      <tr>
        <th style="text-align: center;" width="30%">Product Name & Information</th>
        <th style="text-align: center;" width="10%">Quantity</th>
        <th style="text-align: center;" width="10%">Unit Price</th>
        <th style="text-align: center;" width="15%">Extended Price</th>
      </tr>

    <script>
        generate_item_rows(products);
        function generate_item_rows(products_array) {
        for (i=1; i<= products['tax_service'].length; i++) {
            extended_price_tax = products['tax_service'][i].price * shopping_cart; // Calculate extended price
           // if (shopping_cart['quantity_tax'][i] == 0 || shopping_cart['quantity_tax'][i] == "") continue;
            //else {
                document.write(`
    <tr>
        <td width="33%">Tax Service: ${products['tax_service'][i].CPA_name}, ${shopping_cart}}</td>
        <td align="center" width="10%">0</td>
        <td align="center" width="10%">$${products['tax_service'][i].price}</td>
        <td align="center" width="100%">${extended_price_tax}</td>
    </tr>
            `)
        } 
    }
    </script>
    </tbody>
</table>
</body>
</html>

<style>
    /* Design the navigation bar*/
    /* Reference: https://www.w3schools.com/howto/howto_js_topnav.asp */
    .topnavbar {
    background-color: lightslategrey;
    overflow: hidden;
    }
    .topnavbar a {
    float: center;
    color: whitesmoke;
    text-align: center;
    padding: 14px 16px;
    font-size: 16px;
    }
    .topnavbar a:hover {
    background-color: lightsteelblue;
    color:white;
    }
    .topnavbar a.cart {
    background-color: lightgray;
    color: black;
    }

    body {
        text-align: center;
        background-image: url(./image/background_image_display.jpg);
        background-repeat: no-repeat;
        background-size: cover;
        font-family: 'Courier New';
    }
    img {
        padding-bottom: 20px;
        width: 200px;

    }
    h1 {
        font-size: 50px;
        text-align: left;
    }
    h2 {
        font-style: italic;
    }
    p {
        font-size: 20px;
        font-style: italic;
    }
</style>